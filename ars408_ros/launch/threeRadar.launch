<launch>
    <arg name="plot" default="true"/>
    <arg name="record" default="false"/>
    <arg name="gps_record" default="false"/>
    <arg name="period_in_ms" default="0"/>

    <!-- <arg name="tf_param_third" default="0.0 -0.8 0.0 -1.22 0.0 0.0"/> -->
    <!-- <arg name="tf_param_second" default="0.0 0.8 0.0 1.22 0.0 0.0"/> -->
    <arg name="tf_param_third" default="0.0 0.0 0.0 0.0 0.0 0.0"/>
    <arg name="tf_param_second" default="0.0 0.0 0.0 0.0 0.0 0.0"/>
    
    <arg name="firstRadar" default="/radar/first"/>
    <arg name="firstWork" default="true"/>
    <arg name="secondRadar" default="/radar/second"/>
    <arg name="secondWork" default="true"/>
    <arg name="thirdRadar" default="/radar/third"/>
    <arg name="thirdWork" default="true"/>    

    <!-- Parse raw can data to ros message (Recording) -->
    <node pkg="socketcan_bridge" type="socketcan_to_topic_node" name="socket2cantopic" ns="$(arg firstRadar)" if="$(eval record == true)"> 
        <param name="can_device" value="can0"/>
    </node>/>

    <node pkg="socketcan_bridge" type="socketcan_to_topic_node" name="socket2cantopic" ns="$(arg secondRadar)" if="$(eval record == true)"> 
        <param name="can_device" value="can1"/>
    </node>/>

    <node pkg="socketcan_bridge" type="socketcan_to_topic_node" name="socket2cantopic" ns="$(arg thirdRadar)" if="$(eval record == true)"> 
        <param name="can_device" value="can2"/>
    </node>/>

    
    <!-- Serialize Can Data -->
    <node pkg="ars408_ros" type="cantopic2data" name="cantopic2data" output="screen" ns="$(arg firstRadar)" if="$(eval firstWork == true)">
        <param name="radarChannel" type="string" value="$(arg firstRadar)"/>
    </node>
    <node pkg="ars408_ros" type="cantopic2data" name="cantopic2data" output="screen" ns="$(arg secondRadar)" if="$(eval secondWork == true)">
        <param name="radarChannel" type="string" value="$(arg secondRadar)"/>
    </node>
    <node pkg="ars408_ros" type="cantopic2data" name="cantopic2data" output="screen" ns="$(arg thirdRadar)" if="$(eval thirdWork == true)">
        <param name="radarChannel" type="string" value="$(arg thirdRadar)"/>
    </node>

    <!-- GPS (Recording)-->
    <node pkg="ars408_ros" type ="motionToRadar.py" name="motionToRadar" output="screen" if="$(eval gps_record == true)"></node>
    
    <!-- 3 RADAR -->
    <node pkg="ars408_ros" type="threeRadar.py" name="threeRadar" output="screen" if="$(eval plot == true)"/>
    <!-- AEB -->
    <!-- <node pkg="ars408_ros" type="AEB.py" name="AEB" output="screen">
        <param name="radarChannel" type="string" value="$(arg firstRadar)"/>
    </node> -->

    <!-- IMG calib -->
    <node pkg="ars408_ros" type="rgbToRosSleep.py" name="rgbToRosSleep" output="screen" if="$(eval record == true)"/>
    <node pkg="ars408_ros" type="calibImg.py" name="calibImg" output="screen"/>
    <!-- Plot -->
    <node pkg="ars408_ros" type="plotRadar.py" name="plotRadar" output="screen" if="$(eval plot == true)"/>

    <!-- Visual Radar -->
    <node pkg="ars408_ros" type="visualRadar" name="visualRadar" output="screen" ns="$(arg firstRadar)" if="$(eval firstWork == true and plot == true)">
        <param name="radarChannel" type="string" value="$(arg firstRadar)"/>
    </node>
    <node pkg="ars408_ros" type="visualRadar" name="visualRadar" output="screen" ns="$(arg secondRadar)" if="$(eval secondWork == true and plot == true)">
        <param name="radarChannel" type="string" value="$(arg secondRadar)"/>
    </node>
    <node pkg="ars408_ros" type="visualRadar" name="visualRadar" output="screen" ns="$(arg thirdRadar)" if="$(eval thirdWork == true and plot == true)">
        <param name="radarChannel" type="string" value="$(arg thirdRadar)"/>
    </node>

    <!-- Add New Frame to display on rviz-->
    <node pkg="tf" type="static_transform_publisher" name="second2first" args="$(arg tf_param_second) $(arg firstRadar) $(arg secondRadar) $(arg period_in_ms)" if="$(eval plot == true)"/>
    <node pkg="tf" type="static_transform_publisher" name="third2first" args="$(arg tf_param_third) $(arg firstRadar) $(arg thirdRadar) $(arg period_in_ms)" if="$(eval plot == true)"/>

    <!-- Show on rviz -->
    <node pkg="rviz" type="rviz" name="rv" required="true" args="-d $(find ars408_ros)/rviz/multiRadar.rviz" if="$(eval plot == true)"/>

</launch>
